# Z-SUB 요구사항 정의서 (Requirements Specification)

## 1. 프로젝트 개요

### 1.1 목적

Z-SUB은 정기 구독형 식단 서비스를 위한 **지능형 식단 자동 생성 및 통합 운영 관리 시스템**입니다.
AI 기반 식단 생성 엔진을 통해 10개 타겟(아이, 시니어, 가족 등)에 대한 월간 식단을 자동 생성하고,
Google Sheets 및 기간계 시스템(MIS/ZPPS)과의 양방향 연동을 통해 운영 효율성을 극대화합니다.

### 1.2 범위

- 메뉴 데이터베이스(라이브러리) 관리
- 10개 타겟별 식단 정책 관리 (구성, 원가율, 태그 필터)
- 이중 주기(A조/B조) 식단 자동 생성 (4주 × 2주기)
- AI 전문가 검수 (영양사, 공정, 원가 3자 리뷰)
- 메뉴 교체(Swap) 및 변경 추적
- 구독자 CRM 및 재무 대시보드
- Google Sheets 양방향 동기화
- MIS/ZPPS 기간계 연동
- 감사 로그 및 버전 관리

### 1.3 이해관계자

| 역할                  | 설명                                   |
| --------------------- | -------------------------------------- |
| 매니저 (Manager)      | 전체 시스템 관리, 정책 설정, 최종 승인 |
| 영양사 (Nutritionist) | 식단 생성/검수/교체, 메뉴DB 관리       |
| 운영자 (Operator)     | 데이터 조회, 리포트 확인, CRM 열람     |

---

## 2. 기능 요구사항

### 2.1 메뉴 관리 (Menu Management)

| ID     | 요구사항                                                                                             | 우선순위 |
| ------ | ---------------------------------------------------------------------------------------------------- | -------- |
| FR-001 | 시스템은 메뉴 항목(이름, 카테고리, 원가, 판매가, 맛속성, 계절, 태그, 주재료)을 CRUD할 수 있어야 한다 | P0       |
| FR-002 | 카테고리(국/찌개, 메인요리, 밑반찬, 디저트/간식)별 필터링을 지원해야 한다                            | P0       |
| FR-003 | 메뉴 검색(이름, 품목코드)을 지원해야 한다                                                            | P0       |
| FR-004 | 메뉴의 사용/미사용 상태를 토글할 수 있어야 한다                                                      | P0       |
| FR-005 | CSV 파일을 통한 메뉴 일괄 가져오기를 지원해야 한다                                                   | P2       |
| FR-006 | 메뉴 변경 시 감사 로그를 자동 기록해야 한다                                                          | P2       |

### 2.2 식단 정책 (Meal Plan Policy)

| ID     | 요구사항                                                              | 우선순위 |
| ------ | --------------------------------------------------------------------- | -------- |
| FR-007 | 10개 타겟별 식단 구성 정책(국/메인/반찬 개수)을 설정할 수 있어야 한다 | P0       |
| FR-008 | 기본 식단(Base)과 옵션 식단(Option) 간 상속 구조를 지원해야 한다      | P0       |
| FR-009 | 타겟별 판매가, 목표 원가율, 원가한도를 설정할 수 있어야 한다          | P0       |
| FR-010 | 필수 태그/제외 태그 필터링을 설정할 수 있어야 한다                    | P0       |
| FR-011 | 전체 타겟에 대한 원가율 일괄 변경을 지원해야 한다                     | P1       |

### 2.3 식단 생성 (Meal Plan Generation)

| ID     | 요구사항                                                                | 우선순위 |
| ------ | ----------------------------------------------------------------------- | -------- |
| FR-012 | 선택된 타겟/월에 대해 A조(화수목)/B조(금토월) 식단을 동시 생성해야 한다 | P0       |
| FR-013 | 60일 내 동일 메뉴 중복 방지 옵션을 지원해야 한다                        | P0       |
| FR-014 | 연속 주차 간 주재료 중복을 최소화해야 한다                              | P0       |
| FR-015 | 상위 식단에서 하위 식단을 서브셋으로 자동 파생해야 한다                 | P0       |
| FR-016 | 개별 메뉴 교체(Swap) 시 동일 카테고리·비중복 후보를 제시해야 한다       | P0       |
| FR-017 | 식재료 활용 분포를 시각화해야 한다 (통합 매트릭스)                      | P1       |

### 2.4 AI 검수 (Expert Review)

| ID     | 요구사항                                                                 | 우선순위 |
| ------ | ------------------------------------------------------------------------ | -------- |
| FR-018 | Google Gemini API를 통해 영양사/공정/원가 3자 검수를 수행해야 한다       | P0       |
| FR-019 | 검수 결과에 종합 점수(0~100)와 문제 메뉴 목록을 포함해야 한다            | P0       |
| FR-020 | AI 검수 매뉴얼(자연어 프롬프트)을 관리자가 커스터마이징할 수 있어야 한다 | P1       |

### 2.5 시스템 연동 (Integration)

| ID     | 요구사항                                                                        | 우선순위 |
| ------ | ------------------------------------------------------------------------------- | -------- |
| FR-021 | 확정된 식단을 MIS 시스템에 POST로 등록할 수 있어야 한다                         | P1       |
| FR-022 | 메뉴 교체 내역을 ZPPS 생산 시스템에 PUT으로 반영할 수 있어야 한다               | P1       |
| FR-023 | Google Sheets와 메뉴DB/식단/구독자/재무 데이터를 양방향 동기화할 수 있어야 한다 | P1       |
| FR-024 | 연동 상태(연결 테스트)를 시스템 설정에서 확인할 수 있어야 한다                  | P1       |

### 2.6 구독자 관리 (Subscriber CRM)

| ID     | 요구사항                                                           | 우선순위 |
| ------ | ------------------------------------------------------------------ | -------- |
| FR-025 | 식단별 구독자 수, 신규유입, 이탈률, 만족도를 조회할 수 있어야 한다 | P0       |
| FR-026 | 멤버십 등급(VIP/골드/일반) 분포를 차트로 표시해야 한다             | P1       |
| FR-027 | 주요 구매 연령층 분석을 제공해야 한다                              | P1       |

### 2.7 대시보드 및 재무 (Dashboard & Finance)

| ID     | 요구사항                                                          | 우선순위 |
| ------ | ----------------------------------------------------------------- | -------- |
| FR-028 | KPI 카드(배송건, 활성구독자, 만족도, 매출)를 실시간 표시해야 한다 | P0       |
| FR-029 | 월별 매출/비용/이익 추이 차트를 제공해야 한다                     | P0       |
| FR-030 | 식단별 매출 비중(파이차트) 및 구독 추이(라인차트)를 제공해야 한다 | P1       |

### 2.8 부가 기능

| ID     | 요구사항                                                                | 우선순위 |
| ------ | ----------------------------------------------------------------------- | -------- |
| FR-031 | 식단 생성/교체/동기화에 대한 감사 로그를 기록하고 조회할 수 있어야 한다 | P2       |
| FR-032 | 식단 버전 관리 및 이전 버전과의 diff 비교를 지원해야 한다               | P1       |
| FR-033 | 식단을 PDF로 내보내고 인쇄할 수 있어야 한다                             | P2       |

---

## 3. 비기능 요구사항

### 3.1 성능

| ID      | 요구사항                                                 |
| ------- | -------------------------------------------------------- |
| NFR-001 | 식단 생성은 3초 이내에 완료되어야 한다                   |
| NFR-002 | 페이지 초기 로드(LCP)는 2초 이내여야 한다                |
| NFR-003 | Google Sheets 동기화는 건당 100ms 이내에 처리되어야 한다 |

### 3.2 보안

| ID      | 요구사항                                                             |
| ------- | -------------------------------------------------------------------- |
| NFR-004 | 모든 API 키는 환경변수로 관리하고, 클라이언트에 노출하지 않아야 한다 |
| NFR-005 | Supabase RLS를 통해 역할별 접근 제어를 구현해야 한다                 |
| NFR-006 | 인증은 Supabase Auth를 사용하고, 세션 만료 시 자동 로그아웃해야 한다 |

### 3.3 가용성

| ID      | 요구사항                                                 |
| ------- | -------------------------------------------------------- |
| NFR-007 | 네트워크 오류 시 localStorage 폴백을 지원해야 한다       |
| NFR-008 | Google Sheets 연동 실패 시 오프라인 모드로 동작해야 한다 |

### 3.4 사용성

| ID      | 요구사항                                                                  |
| ------- | ------------------------------------------------------------------------- |
| NFR-009 | 모든 사용자 알림은 토스트 시스템을 통해 제공해야 한다 (window.alert 금지) |
| NFR-010 | 파괴적 작업은 확인 다이얼로그를 통해 사용자 동의를 받아야 한다            |
| NFR-011 | 반응형 레이아웃을 지원해야 한다 (최소 1280px)                             |

---

## 4. 데이터 요구사항

### 4.1 메뉴 DB

- 필드: id, code, name, category, cost, recommendedPrice, tastes[], season, tags[], isSpicy, mainIngredient, process, weight, isUnused, imageUrl
- 예상 레코드: 45~200개

### 4.2 식단 정책

- 필드: target, budgetCap, targetPrice, targetCostRatio, composition{}, bannedTags[], requiredTags[], parentTarget
- 예상 레코드: 10개 (타겟당 1개)

### 4.3 구독자 스냅샷

- 필드: target, totalSubscribers, newSubscribers, churnRate, satisfaction, tiers[], demographics[]
- 예상 레코드: 10개/월

### 4.4 재무 데이터

- 필드: month, revenue, cost, profit
- 예상 레코드: 12개/년

---

## 5. 기술 스택

| 영역       | 기술                                              |
| ---------- | ------------------------------------------------- |
| 프론트엔드 | React 19, TypeScript, Tailwind CSS 4, Vite 6      |
| 차트       | Recharts 3                                        |
| AI         | Google Gemini API (@google/genai)                 |
| 백엔드     | Supabase (PostgreSQL + Auth + RLS)                |
| 외부 연동  | Google Sheets API (googleapis), MIS/ZPPS REST API |
| 테스트     | Vitest, Playwright, Testing Library               |
| 코드 품질  | ESLint, Prettier, Husky + lint-staged             |
